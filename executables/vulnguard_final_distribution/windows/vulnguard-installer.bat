@echo off
REM VulnGuard Platform Installer
REM VulnGuard Security Platform v2.0

REM Check if Python is installed
python --version >nul 2>&1
if errorlevel 1 (
    echo.
    echo ERROR: Python is required but not installed.
    echo Please install Python 3.8+ from https://python.org
    echo.
    pause
    exit /b 1
)

REM Check and install dependencies
python -c "import requests" >nul 2>&1
if errorlevel 1 (
    echo Installing required dependencies...
    python -m pip install --quiet requests psutil pymongo fastapi uvicorn motor python-dotenv pydantic python-multipart
)

REM Get the directory where this script is located
set SCRIPT_DIR=%~dp0

REM Create temporary Python script
set TEMP_SCRIPT=%TEMP%\vulnguard_installer.py

REM Write the Python code to temp file (base64 encoded to handle special characters)
echo IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIKVnVsbkd1YXJkIFBsYXRmb3JtIEluc3RhbGxlcgpTZWxmLWNvbnRhaW5lZCBpbnN0YWxsZXIgZm9yIHRoZSBjb21wbGV0ZSBWdWxuR3VhcmQgcGxhdGZvcm0KSW5zdGFsbHMgYWxsIGRlcGVuZGVuY2llcyBhbmQgc2V0cyB1cCB0aGUgcGxhdGZvcm0gb24gV2luZG93cy9MaW51eAoiIiIKCmltcG9ydCBvcwppbXBvcnQgc3lzCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCBwbGF0Zm9ybQppbXBvcnQgdXJsbGliLnJlcXVlc3QKaW1wb3J0IHRhcmZpbGUKaW1wb3J0IHppcGZpbGUKaW1wb3J0IGpzb24KaW1wb3J0IHNodXRpbApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKaW1wb3J0IHRlbXBmaWxlCmltcG9ydCB0aW1lCgpjbGFzcyBWdWxuR3VhcmRJbnN0YWxsZXI6CiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5wbGF0Zm9ybSA9IHBsYXRmb3JtLnN5c3RlbSgpLmxvd2VyKCkKICAgICAgICBzZWxmLmFyY2hpdGVjdHVyZSA9IHBsYXRmb3JtLm1hY2hpbmUoKS5sb3dlcigpCiAgICAgICAgc2VsZi5pbnN0YWxsX2RpciA9IFBhdGguaG9tZSgpIC8gJ1Z1bG5HdWFyZCcKICAgICAgICBzZWxmLnRlbXBfZGlyID0gUGF0aCh0ZW1wZmlsZS5ta2R0ZW1wKCkpCiAgICAgICAgCiAgICAgICAgIyBDb21wb25lbnQgdmVyc2lvbnMKICAgICAgICBzZWxmLnZlcnNpb25zID0gewogICAgICAgICAgICAncHl0aG9uJzogJzMuMTEuMCcsCiAgICAgICAgICAgICdub2RlanMnOiAnMTguMTcuMCcsCiAgICAgICAgICAgICdtb25nb2RiJzogJzcuMC4yJwogICAgICAgIH0KICAgICAgICAKICAgICAgICBwcmludCgi8J+boe+4jyAgVnVsbkd1YXJkIFBsYXRmb3JtIEluc3RhbGxlciB2Mi4wIikKICAgICAgICBwcmludCgiPSIqNTApCiAgICAgICAgcHJpbnQoZiJQbGF0Zm9ybToge3BsYXRmb3JtLnN5c3RlbSgpfSB7cGxhdGZvcm0ucmVsZWFzZSgpfSIpCiAgICAgICAgcHJpbnQoZiJBcmNoaXRlY3R1cmU6IHtwbGF0Zm9ybS5tYWNoaW5lKCl9IikKICAgICAgICBwcmludChmIkluc3RhbGwgRGlyZWN0b3J5OiB7c2VsZi5pbnN0YWxsX2Rpcn0iKQogICAgICAgIHByaW50KCI9Iio1MCkKICAgIAogICAgZGVmIGNoZWNrX3ByZXJlcXVpc2l0ZXMoc2VsZik6CiAgICAgICAgIiIiQ2hlY2sgc3lzdGVtIHByZXJlcXVpc2l0ZXMiIiIKICAgICAgICBwcmludCgiXG7wn5OLIENoZWNraW5nIHByZXJlcXVpc2l0ZXMuLi4iKQogICAgICAgIAogICAgICAgIHByZXJlcXVpc2l0ZXMgPSBbXQogICAgICAgIAogICAgICAgICMgQ2hlY2sgYXZhaWxhYmxlIGRpc2sgc3BhY2UgKG5lZWQgYXQgbGVhc3QgMkdCKQogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgc2VsZi5wbGF0Zm9ybSA9PSAnd2luZG93cyc6CiAgICAgICAgICAgICAgICBpbXBvcnQgc2h1dGlsCiAgICAgICAgICAgICAgICBmcmVlX2J5dGVzID0gc2h1dGlsLmRpc2tfdXNhZ2UoJy4nKS5mcmVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpbXBvcnQgc2h1dGlsCiAgICAgICAgICAgICAgICBmcmVlX2J5dGVzID0gc2h1dGlsLmRpc2tfdXNhZ2UoJy4nKS5mcmVlCiAgICAgICAgICAgIAogICAgICAgICAgICBmcmVlX2diID0gZnJlZV9ieXRlcyAvICgxMDI0KiozKQogICAgICAgICAgICBpZiBmcmVlX2diIDwgMjoKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MIEluc3VmZmljaWVudCBkaXNrIHNwYWNlOiB7ZnJlZV9nYjouMWZ9R0IgYXZhaWxhYmxlLCBuZWVkIDJHQiBtaW5pbXVtIikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiLinIUgRGlzayBzcGFjZToge2ZyZWVfZ2I6LjFmfUdCIGF2YWlsYWJsZSIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4pqg77iPICBDb3VsZCBub3QgY2hlY2sgZGlzayBzcGFjZToge2V9IikKICAgICAgICAKICAgICAgICAjIENoZWNrIGlmIHJ1bm5pbmcgYXMgYWRtaW5pc3RyYXRvci9yb290IGZvciBzeXN0ZW0td2lkZSBpbnN0YWxsYXRpb24KICAgICAgICBpZiBzZWxmLnBsYXRmb3JtID09ICd3aW5kb3dzJzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaW1wb3J0IGN0eXBlcwogICAgICAgICAgICAgICAgaXNfYWRtaW4gPSBjdHlwZXMud2luZGxsLnNoZWxsMzIuSXNVc2VyQW5BZG1pbigpCiAgICAgICAgICAgICAgICBpZiBub3QgaXNfYWRtaW46CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKaoO+4jyAgTm90IHJ1bm5pbmcgYXMgYWRtaW5pc3RyYXRvciAtIGluc3RhbGxpbmcgdG8gdXNlciBkaXJlY3RvcnkiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludCgi4pyFIFJ1bm5pbmcgYXMgYWRtaW5pc3RyYXRvciIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KCLimqDvuI8gIENvdWxkIG5vdCBjaGVjayBhZG1pbmlzdHJhdG9yIHN0YXR1cyIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgb3MuZ2V0ZXVpZCgpID09IDA6CiAgICAgICAgICAgICAgICBwcmludCgi4pyFIFJ1bm5pbmcgYXMgcm9vdCIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgi4pqg77iPICBOb3QgcnVubmluZyBhcyByb290IC0gaW5zdGFsbGluZyB0byB1c2VyIGRpcmVjdG9yeSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIFRydWUKICAgIAogICAgZGVmIGRvd25sb2FkX2ZpbGUoc2VsZiwgdXJsLCBmaWxlbmFtZSk6CiAgICAgICAgIiIiRG93bmxvYWQgZmlsZSB3aXRoIHByb2dyZXNzIiIiCiAgICAgICAgcHJpbnQoZiLwn5OlIERvd25sb2FkaW5nIHtmaWxlbmFtZX0uLi4iKQogICAgICAgIAogICAgICAgIGRlZiBwcm9ncmVzc19ob29rKGJsb2NrX251bSwgYmxvY2tfc2l6ZSwgdG90YWxfc2l6ZSk6CiAgICAgICAgICAgIGlmIHRvdGFsX3NpemUgPiAwOgogICAgICAgICAgICAgICAgcGVyY2VudCA9IG1pbigxMDAsIChibG9ja19udW0gKiBibG9ja19zaXplICogMTAwKSAvIHRvdGFsX3NpemUpCiAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LndyaXRlKGYiXHJ7cGVyY2VudDouMWZ9JSIpCiAgICAgICAgICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVybGxpYi5yZXF1ZXN0LnVybHJldHJpZXZlKHVybCwgZmlsZW5hbWUsIHByb2dyZXNzX2hvb2spCiAgICAgICAgICAgIHByaW50KGYiIOKchSBEb3dubG9hZGVkIHtmaWxlbmFtZX0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiIg4p2MIEZhaWxlZCB0byBkb3dubG9hZCB7ZmlsZW5hbWV9OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGluc3RhbGxfcHl0aG9uKHNlbGYpOgogICAgICAgICIiIkluc3RhbGwgUHl0aG9uIGlmIG5vdCBhdmFpbGFibGUiIiIKICAgICAgICBwcmludCgiXG7wn5CNIENoZWNraW5nIFB5dGhvbiBpbnN0YWxsYXRpb24uLi4iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyBDaGVjayBpZiBQeXRob24gaXMgYWxyZWFkeSBpbnN0YWxsZWQKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oW3N5cy5leGVjdXRhYmxlLCAnLS12ZXJzaW9uJ10sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOgogICAgICAgICAgICAgICAgdmVyc2lvbiA9IHJlc3VsdC5zdGRvdXQuc3RyaXAoKQogICAgICAgICAgICAgICAgcHJpbnQoZiLinIUgUHl0aG9uIGFscmVhZHkgaW5zdGFsbGVkOiB7dmVyc2lvbn0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICBwcmludCgi8J+TpiBJbnN0YWxsaW5nIFB5dGhvbi4uLiIpCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5wbGF0Zm9ybSA9PSAnd2luZG93cyc6CiAgICAgICAgICAgICMgRG93bmxvYWQgUHl0aG9uIGluc3RhbGxlciBmb3IgV2luZG93cwogICAgICAgICAgICBweXRob25fdXJsID0gZiJodHRwczovL3d3dy5weXRob24ub3JnL2Z0cC9weXRob24ve3NlbGYudmVyc2lvbnNbJ3B5dGhvbiddfS9weXRob24te3NlbGYudmVyc2lvbnNbJ3B5dGhvbiddfS1hbWQ2NC5leGUiCiAgICAgICAgICAgIGluc3RhbGxlcl9wYXRoID0gc2VsZi50ZW1wX2RpciAvICdweXRob24taW5zdGFsbGVyLmV4ZScKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlbGYuZG93bmxvYWRfZmlsZShweXRob25fdXJsLCBpbnN0YWxsZXJfcGF0aCk6CiAgICAgICAgICAgICAgICAjIFJ1biBpbnN0YWxsZXIgc2lsZW50bHkKICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFtzdHIoaW5zdGFsbGVyX3BhdGgpLCAnL3F1aWV0JywgJ0luc3RhbGxBbGxVc2Vycz0xJywgJ1ByZXBlbmRQYXRoPTEnXSkKICAgICAgICAgICAgICAgIHByaW50KCLinIUgUHl0aG9uIGluc3RhbGxhdGlvbiBjb21wbGV0ZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBlbGlmIHNlbGYucGxhdGZvcm0gPT0gJ2xpbnV4JzoKICAgICAgICAgICAgIyBUcnkgdG8gaW5zdGFsbCB2aWEgcGFja2FnZSBtYW5hZ2VyCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgVHJ5IGFwdC1nZXQgKERlYmlhbi9VYnVudHUpCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ3N1ZG8nLCAnYXB0LWdldCcsICd1cGRhdGUnXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnc3VkbycsICdhcHQtZ2V0JywgJ2luc3RhbGwnLCAnLXknLCAncHl0aG9uMycsICdweXRob24zLXBpcCcsICdweXRob24zLXZlbnYnXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgICAgIHByaW50KCLinIUgUHl0aG9uIGluc3RhbGxlZCB2aWEgYXB0LWdldCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgIyBUcnkgeXVtIChSZWRIYXQvQ2VudE9TKQogICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnc3VkbycsICd5dW0nLCAnaW5zdGFsbCcsICcteScsICdweXRob24zJywgJ3B5dGhvbjMtcGlwJ10sIGNoZWNrPVRydWUpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKchSBQeXRob24gaW5zdGFsbGVkIHZpYSB5dW0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBDb3VsZCBub3QgaW5zdGFsbCBQeXRob24gYXV0b21hdGljYWxseSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgCiAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIGRlZiBpbnN0YWxsX25vZGVqcyhzZWxmKToKICAgICAgICAiIiJJbnN0YWxsIE5vZGUuanMgaWYgbm90IGF2YWlsYWJsZSIiIgogICAgICAgIHByaW50KCJcbvCfk6YgQ2hlY2tpbmcgTm9kZS5qcyBpbnN0YWxsYXRpb24uLi4iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oWydub2RlJywgJy0tdmVyc2lvbiddLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6CiAgICAgICAgICAgICAgICB2ZXJzaW9uID0gcmVzdWx0LnN0ZG91dC5zdHJpcCgpCiAgICAgICAgICAgICAgICBwcmludChmIuKchSBOb2RlLmpzIGFscmVhZHkgaW5zdGFsbGVkOiB7dmVyc2lvbn0iKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICBwcmludCgi8J+TpiBJbnN0YWxsaW5nIE5vZGUuanMuLi4iKQogICAgICAgIAogICAgICAgIGlmIHNlbGYucGxhdGZvcm0gPT0gJ3dpbmRvd3MnOgogICAgICAgICAgICAjIERvd25sb2FkIE5vZGUuanMgaW5zdGFsbGVyIGZvciBXaW5kb3dzCiAgICAgICAgICAgIG5vZGVfdXJsID0gZiJodHRwczovL25vZGVqcy5vcmcvZGlzdC92e3NlbGYudmVyc2lvbnNbJ25vZGVqcyddfS9ub2RlLXZ7c2VsZi52ZXJzaW9uc1snbm9kZWpzJ119LXg2NC5tc2kiCiAgICAgICAgICAgIGluc3RhbGxlcl9wYXRoID0gc2VsZi50ZW1wX2RpciAvICdub2RlanMtaW5zdGFsbGVyLm1zaScKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlbGYuZG93bmxvYWRfZmlsZShub2RlX3VybCwgaW5zdGFsbGVyX3BhdGgpOgogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydtc2lleGVjJywgJy9pJywgc3RyKGluc3RhbGxlcl9wYXRoKSwgJy9xdWlldCddKQogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBOb2RlLmpzIGluc3RhbGxhdGlvbiBjb21wbGV0ZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBlbGlmIHNlbGYucGxhdGZvcm0gPT0gJ2xpbnV4JzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBJbnN0YWxsIHZpYSBwYWNrYWdlIG1hbmFnZXIKICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnc3VkbycsICdhcHQtZ2V0JywgJ2luc3RhbGwnLCAnLXknLCAnbm9kZWpzJywgJ25wbSddLCBjaGVjaz1UcnVlKQogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBOb2RlLmpzIGluc3RhbGxlZCB2aWEgYXB0LWdldCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydzdWRvJywgJ3l1bScsICdpbnN0YWxsJywgJy15JywgJ25vZGVqcycsICducG0nXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBwcmludCgi4pyFIE5vZGUuanMgaW5zdGFsbGVkIHZpYSB5dW0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBDb3VsZCBub3QgaW5zdGFsbCBOb2RlLmpzIGF1dG9tYXRpY2FsbHkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgaW5zdGFsbF9tb25nb2RiKHNlbGYpOgogICAgICAgICIiIkluc3RhbGwgTW9uZ29EQiBpZiBub3QgYXZhaWxhYmxlIiIiCiAgICAgICAgcHJpbnQoIlxu8J+TpiBDaGVja2luZyBNb25nb0RCIGluc3RhbGxhdGlvbi4uLiIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ21vbmdvZCcsICctLXZlcnNpb24nXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOgogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBNb25nb0RCIGFscmVhZHkgaW5zdGFsbGVkIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgcHJpbnQoIvCfk6YgSW5zdGFsbGluZyBNb25nb0RCLi4uIikKICAgICAgICAKICAgICAgICBpZiBzZWxmLnBsYXRmb3JtID09ICd3aW5kb3dzJzoKICAgICAgICAgICAgIyBEb3dubG9hZCBNb25nb0RCIGluc3RhbGxlciBmb3IgV2luZG93cwogICAgICAgICAgICBtb25nb191cmwgPSBmImh0dHBzOi8vZmFzdGRsLm1vbmdvZGIub3JnL3dpbmRvd3MvbW9uZ29kYi13aW5kb3dzLXg4Nl82NC17c2VsZi52ZXJzaW9uc1snbW9uZ29kYiddfS56aXAiCiAgICAgICAgICAgIGluc3RhbGxlcl9wYXRoID0gc2VsZi50ZW1wX2RpciAvICdtb25nb2RiLnppcCcKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlbGYuZG93bmxvYWRfZmlsZShtb25nb191cmwsIGluc3RhbGxlcl9wYXRoKToKICAgICAgICAgICAgICAgICMgRXh0cmFjdCBNb25nb0RCCiAgICAgICAgICAgICAgICB3aXRoIHppcGZpbGUuWmlwRmlsZShpbnN0YWxsZXJfcGF0aCwgJ3InKSBhcyB6aXBfcmVmOgogICAgICAgICAgICAgICAgICAgIHppcF9yZWYuZXh0cmFjdGFsbChzZWxmLmluc3RhbGxfZGlyIC8gJ21vbmdvZGInKQogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBNb25nb0RCIGluc3RhbGxhdGlvbiBjb21wbGV0ZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAKICAgICAgICBlbGlmIHNlbGYucGxhdGZvcm0gPT0gJ2xpbnV4JzoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBJbnN0YWxsIHZpYSBwYWNrYWdlIG1hbmFnZXIKICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnc3VkbycsICdhcHQtZ2V0JywgJ2luc3RhbGwnLCAnLXknLCAnbW9uZ29kYiddLCBjaGVjaz1UcnVlKQogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBNb25nb0RCIGluc3RhbGxlZCB2aWEgYXB0LWdldCIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydzdWRvJywgJ3l1bScsICdpbnN0YWxsJywgJy15JywgJ21vbmdvZGInXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBwcmludCgi4pyFIE1vbmdvREIgaW5zdGFsbGVkIHZpYSB5dW0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBDb3VsZCBub3QgaW5zdGFsbCBNb25nb0RCIGF1dG9tYXRpY2FsbHkiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgY3JlYXRlX2RpcmVjdG9yeV9zdHJ1Y3R1cmUoc2VsZik6CiAgICAgICAgIiIiQ3JlYXRlIFZ1bG5HdWFyZCBkaXJlY3Rvcnkgc3RydWN0dXJlIiIiCiAgICAgICAgcHJpbnQoIlxu8J+TgSBDcmVhdGluZyBkaXJlY3Rvcnkgc3RydWN0dXJlLi4uIikKICAgICAgICAKICAgICAgICBkaXJlY3RvcmllcyA9IFsKICAgICAgICAgICAgc2VsZi5pbnN0YWxsX2RpciwKICAgICAgICAgICAgc2VsZi5pbnN0YWxsX2RpciAvICdiYWNrZW5kJywKICAgICAgICAgICAgc2VsZi5pbnN0YWxsX2RpciAvICdmcm9udGVuZCcsCiAgICAgICAgICAgIHNlbGYuaW5zdGFsbF9kaXIgLyAnZXhlY3V0YWJsZXMnLAogICAgICAgICAgICBzZWxmLmluc3RhbGxfZGlyIC8gJ2RhdGEnLAogICAgICAgICAgICBzZWxmLmluc3RhbGxfZGlyIC8gJ2xvZ3MnLAogICAgICAgICAgICBzZWxmLmluc3RhbGxfZGlyIC8gJ2NvbmZpZycKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIGRpcmVjdG9yeSBpbiBkaXJlY3RvcmllczoKICAgICAgICAgICAgZGlyZWN0b3J5Lm1rZGlyKHBhcmVudHM9VHJ1ZSwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAgICAgcHJpbnQoZiLinIUgQ3JlYXRlZCB7ZGlyZWN0b3J5fSIpCiAgICAKICAgIGRlZiBpbnN0YWxsX3Z1bG5ndWFyZF9wbGF0Zm9ybShzZWxmKToKICAgICAgICAiIiJJbnN0YWxsIFZ1bG5HdWFyZCBwbGF0Zm9ybSBmaWxlcyIiIgogICAgICAgIHByaW50KCJcbvCfm6HvuI8gIEluc3RhbGxpbmcgVnVsbkd1YXJkIHBsYXRmb3JtLi4uIikKICAgICAgICAKICAgICAgICAjIEJhY2tlbmQgZmlsZXMKICAgICAgICBiYWNrZW5kX2ZpbGVzID0gewogICAgICAgICAgICAnc2VydmVyLnB5Jzogc2VsZi5nZXRfYmFja2VuZF9jb2RlKCksCiAgICAgICAgICAgICdyZXF1aXJlbWVudHMudHh0Jzogc2VsZi5nZXRfcmVxdWlyZW1lbnRzKCksCiAgICAgICAgICAgICcuZW52Jzogc2VsZi5nZXRfYmFja2VuZF9lbnYoKQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgZmlsZW5hbWUsIGNvbnRlbnQgaW4gYmFja2VuZF9maWxlcy5pdGVtcygpOgogICAgICAgICAgICBmaWxlX3BhdGggPSBzZWxmLmluc3RhbGxfZGlyIC8gJ2JhY2tlbmQnIC8gZmlsZW5hbWUKICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShjb250ZW50KQogICAgICAgICAgICBwcmludChmIuKchSBDcmVhdGVkIHtmaWxlX3BhdGh9IikKICAgICAgICAKICAgICAgICAjIEZyb250ZW5kIGZpbGVzCiAgICAgICAgZnJvbnRlbmRfZmlsZXMgPSB7CiAgICAgICAgICAgICdwYWNrYWdlLmpzb24nOiBzZWxmLmdldF9wYWNrYWdlX2pzb24oKSwKICAgICAgICAgICAgJy5lbnYnOiBzZWxmLmdldF9mcm9udGVuZF9lbnYoKQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmb3IgZmlsZW5hbWUsIGNvbnRlbnQgaW4gZnJvbnRlbmRfZmlsZXMuaXRlbXMoKToKICAgICAgICAgICAgZmlsZV9wYXRoID0gc2VsZi5pbnN0YWxsX2RpciAvICdmcm9udGVuZCcgLyBmaWxlbmFtZQogICAgICAgICAgICB3aXRoIG9wZW4oZmlsZV9wYXRoLCAndycpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGNvbnRlbnQpCiAgICAgICAgICAgIHByaW50KGYi4pyFIENyZWF0ZWQge2ZpbGVfcGF0aH0iKQogICAgICAgIAogICAgICAgICMgQ3JlYXRlIHNyYyBkaXJlY3RvcnkgYW5kIGJhc2ljIFJlYWN0IGFwcAogICAgICAgIHNyY19kaXIgPSBzZWxmLmluc3RhbGxfZGlyIC8gJ2Zyb250ZW5kJyAvICdzcmMnCiAgICAgICAgc3JjX2Rpci5ta2RpcihleGlzdF9vaz1UcnVlKQogICAgICAgIAogICAgICAgIGFwcF9qcyA9IHNyY19kaXIgLyAnQXBwLmpzJwogICAgICAgIHdpdGggb3BlbihhcHBfanMsICd3JykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShzZWxmLmdldF9yZWFjdF9hcHAoKSkKICAgICAgICBwcmludChmIuKchSBDcmVhdGVkIHthcHBfanN9IikKICAgIAogICAgZGVmIGluc3RhbGxfcHl0aG9uX2RlcGVuZGVuY2llcyhzZWxmKToKICAgICAgICAiIiJJbnN0YWxsIFB5dGhvbiBkZXBlbmRlbmNpZXMiIiIKICAgICAgICBwcmludCgiXG7wn5OmIEluc3RhbGxpbmcgUHl0aG9uIGRlcGVuZGVuY2llcy4uLiIpCiAgICAgICAgCiAgICAgICAgcmVxdWlyZW1lbnRzX2ZpbGUgPSBzZWxmLmluc3RhbGxfZGlyIC8gJ2JhY2tlbmQnIC8gJ3JlcXVpcmVtZW50cy50eHQnCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIENyZWF0ZSB2aXJ0dWFsIGVudmlyb25tZW50CiAgICAgICAgICAgIHZlbnZfcGF0aCA9IHNlbGYuaW5zdGFsbF9kaXIgLyAnYmFja2VuZCcgLyAndmVudicKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oW3N5cy5leGVjdXRhYmxlLCAnLW0nLCAndmVudicsIHN0cih2ZW52X3BhdGgpXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQWN0aXZhdGUgdmlydHVhbCBlbnZpcm9ubWVudCBhbmQgaW5zdGFsbCBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgaWYgc2VsZi5wbGF0Zm9ybSA9PSAnd2luZG93cyc6CiAgICAgICAgICAgICAgICBwaXBfcGF0aCA9IHZlbnZfcGF0aCAvICdTY3JpcHRzJyAvICdwaXAuZXhlJwogICAgICAgICAgICAgICAgcHl0aG9uX3BhdGggPSB2ZW52X3BhdGggLyAnU2NyaXB0cycgLyAncHl0aG9uLmV4ZScKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHBpcF9wYXRoID0gdmVudl9wYXRoIC8gJ2JpbicgLyAncGlwJwogICAgICAgICAgICAgICAgcHl0aG9uX3BhdGggPSB2ZW52X3BhdGggLyAnYmluJyAvICdweXRob24nCiAgICAgICAgICAgIAogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbc3RyKHBpcF9wYXRoKSwgJ2luc3RhbGwnLCAnLS11cGdyYWRlJywgJ3BpcCddLCBjaGVjaz1UcnVlKQogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbc3RyKHBpcF9wYXRoKSwgJ2luc3RhbGwnLCAnLXInLCBzdHIocmVxdWlyZW1lbnRzX2ZpbGUpXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KCLinIUgUHl0aG9uIGRlcGVuZGVuY2llcyBpbnN0YWxsZWQgc3VjY2Vzc2Z1bGx5IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIuKdjCBGYWlsZWQgdG8gaW5zdGFsbCBQeXRob24gZGVwZW5kZW5jaWVzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGluc3RhbGxfbm9kZV9kZXBlbmRlbmNpZXMoc2VsZik6CiAgICAgICAgIiIiSW5zdGFsbCBOb2RlLmpzIGRlcGVuZGVuY2llcyIiIgogICAgICAgIHByaW50KCJcbvCfk6YgSW5zdGFsbGluZyBOb2RlLmpzIGRlcGVuZGVuY2llcy4uLiIpCiAgICAgICAgCiAgICAgICAgZnJvbnRlbmRfZGlyID0gc2VsZi5pbnN0YWxsX2RpciAvICdmcm9udGVuZCcKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2hhbmdlIHRvIGZyb250ZW5kIGRpcmVjdG9yeSBhbmQgaW5zdGFsbCBkZXBlbmRlbmNpZXMKICAgICAgICAgICAgb3JpZ2luYWxfZGlyID0gb3MuZ2V0Y3dkKCkKICAgICAgICAgICAgb3MuY2hkaXIoZnJvbnRlbmRfZGlyKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWyducG0nLCAnaW5zdGFsbCddLCBjaGVjaz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgb3MuY2hkaXIob3JpZ2luYWxfZGlyKQogICAgICAgICAgICBwcmludCgi4pyFIE5vZGUuanMgZGVwZW5kZW5jaWVzIGluc3RhbGxlZCBzdWNjZXNzZnVsbHkiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4p2MIEZhaWxlZCB0byBpbnN0YWxsIE5vZGUuanMgZGVwZW5kZW5jaWVzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGNyZWF0ZV9zdGFydHVwX3NjcmlwdHMoc2VsZik6CiAgICAgICAgIiIiQ3JlYXRlIHN0YXJ0dXAgc2NyaXB0cyIiIgogICAgICAgIHByaW50KCJcbvCfk50gQ3JlYXRpbmcgc3RhcnR1cCBzY3JpcHRzLi4uIikKICAgICAgICAKICAgICAgICBpZiBzZWxmLnBsYXRmb3JtID09ICd3aW5kb3dzJzoKICAgICAgICAgICAgIyBXaW5kb3dzIGJhdGNoIGZpbGVzCiAgICAgICAgICAgIHN0YXJ0X3NjcmlwdCA9IHNlbGYuaW5zdGFsbF9kaXIgLyAnc3RhcnRfdnVsbmd1YXJkLmJhdCcKICAgICAgICAgICAgd2l0aCBvcGVuKHN0YXJ0X3NjcmlwdCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShzZWxmLmdldF93aW5kb3dzX3N0YXJ0X3NjcmlwdCgpKQogICAgICAgICAgICBwcmludChmIuKchSBDcmVhdGVkIHtzdGFydF9zY3JpcHR9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHN0b3Bfc2NyaXB0ID0gc2VsZi5pbnN0YWxsX2RpciAvICdzdG9wX3Z1bG5ndWFyZC5iYXQnCiAgICAgICAgICAgIHdpdGggb3BlbihzdG9wX3NjcmlwdCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShzZWxmLmdldF93aW5kb3dzX3N0b3Bfc2NyaXB0KCkpCiAgICAgICAgICAgIHByaW50KGYi4pyFIENyZWF0ZWQge3N0b3Bfc2NyaXB0fSIpCiAgICAgICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgTGludXggc2hlbGwgc2NyaXB0cwogICAgICAgICAgICBzdGFydF9zY3JpcHQgPSBzZWxmLmluc3RhbGxfZGlyIC8gJ3N0YXJ0X3Z1bG5ndWFyZC5zaCcKICAgICAgICAgICAgd2l0aCBvcGVuKHN0YXJ0X3NjcmlwdCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShzZWxmLmdldF9saW51eF9zdGFydF9zY3JpcHQoKSkKICAgICAgICAgICAgb3MuY2htb2Qoc3RhcnRfc2NyaXB0LCAwbzc1NSkKICAgICAgICAgICAgcHJpbnQoZiLinIUgQ3JlYXRlZCB7c3RhcnRfc2NyaXB0fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBzdG9wX3NjcmlwdCA9IHNlbGYuaW5zdGFsbF9kaXIgLyAnc3RvcF92dWxuZ3VhcmQuc2gnCiAgICAgICAgICAgIHdpdGggb3BlbihzdG9wX3NjcmlwdCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShzZWxmLmdldF9saW51eF9zdG9wX3NjcmlwdCgpKQogICAgICAgICAgICBvcy5jaG1vZChzdG9wX3NjcmlwdCwgMG83NTUpCiAgICAgICAgICAgIHByaW50KGYi4pyFIENyZWF0ZWQge3N0b3Bfc2NyaXB0fSIpCiAgICAKICAgIGRlZiBjcmVhdGVfZGVza3RvcF9zaG9ydGN1dHMoc2VsZik6CiAgICAgICAgIiIiQ3JlYXRlIGRlc2t0b3Agc2hvcnRjdXRzIiIiCiAgICAgICAgcHJpbnQoIlxu8J+Wpe+4jyAgQ3JlYXRpbmcgZGVza3RvcCBzaG9ydGN1dHMuLi4iKQogICAgICAgIAogICAgICAgIGlmIHNlbGYucGxhdGZvcm0gPT0gJ3dpbmRvd3MnOgogICAgICAgICAgICAjIENyZWF0ZSBXaW5kb3dzIHNob3J0Y3V0cyAoc2ltcGxpZmllZCkKICAgICAgICAgICAgZGVza3RvcCA9IFBhdGguaG9tZSgpIC8gJ0Rlc2t0b3AnCiAgICAgICAgICAgIHNob3J0Y3V0X3BhdGggPSBkZXNrdG9wIC8gJ1Z1bG5HdWFyZC5iYXQnCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4oc2hvcnRjdXRfcGF0aCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShmJ0BlY2hvIG9mZlxuY2QgL2QgIntzZWxmLmluc3RhbGxfZGlyfSJcbnN0YXJ0IGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFxuY2FsbCBzdGFydF92dWxuZ3VhcmQuYmF0XG4nKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiLinIUgQ3JlYXRlZCBkZXNrdG9wIHNob3J0Y3V0OiB7c2hvcnRjdXRfcGF0aH0iKQogICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgQ3JlYXRlIExpbnV4IGRlc2t0b3AgZW50cnkKICAgICAgICAgICAgZGVza3RvcF9lbnRyeSA9IGYiIiJbRGVza3RvcCBFbnRyeV0KTmFtZT1WdWxuR3VhcmQKQ29tbWVudD1WdWxuZXJhYmlsaXR5IE1hbmFnZW1lbnQgUGxhdGZvcm0KRXhlYz17c2VsZi5pbnN0YWxsX2Rpcn0vc3RhcnRfdnVsbmd1YXJkLnNoCkljb249e3NlbGYuaW5zdGFsbF9kaXJ9L2ljb24ucG5nClRlcm1pbmFsPWZhbHNlClR5cGU9QXBwbGljYXRpb24KQ2F0ZWdvcmllcz1TZWN1cml0eTtOZXR3b3JrOwoiIiIKICAgICAgICAgICAgCiAgICAgICAgICAgIGRlc2t0b3BfZGlyID0gUGF0aC5ob21lKCkgLyAnRGVza3RvcCcKICAgICAgICAgICAgaWYgZGVza3RvcF9kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBzaG9ydGN1dF9wYXRoID0gZGVza3RvcF9kaXIgLyAnVnVsbkd1YXJkLmRlc2t0b3AnCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oc2hvcnRjdXRfcGF0aCwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZGVza3RvcF9lbnRyeSkKICAgICAgICAgICAgICAgIG9zLmNobW9kKHNob3J0Y3V0X3BhdGgsIDBvNzU1KQogICAgICAgICAgICAgICAgcHJpbnQoZiLinIUgQ3JlYXRlZCBkZXNrdG9wIHNob3J0Y3V0OiB7c2hvcnRjdXRfcGF0aH0iKQogICAgCiAgICBkZWYgc2V0dXBfc3lzdGVtX3NlcnZpY2Uoc2VsZik6CiAgICAgICAgIiIiU2V0dXAgVnVsbkd1YXJkIGFzIHN5c3RlbSBzZXJ2aWNlIiIiCiAgICAgICAgcHJpbnQoIlxu4pqZ77iPICBTZXR0aW5nIHVwIHN5c3RlbSBzZXJ2aWNlLi4uIikKICAgICAgICAKICAgICAgICBpZiBzZWxmLnBsYXRmb3JtID09ICd3aW5kb3dzJzoKICAgICAgICAgICAgIyBXaW5kb3dzIHNlcnZpY2Ugc2V0dXAgd291bGQgcmVxdWlyZSBhZGRpdGlvbmFsIHRvb2xzCiAgICAgICAgICAgIHByaW50KCLimqDvuI8gIFdpbmRvd3Mgc2VydmljZSBzZXR1cCByZXF1aXJlcyBtYW51YWwgY29uZmlndXJhdGlvbiIpCiAgICAgICAgICAgIHByaW50KGYiICAgVXNlIFRhc2sgU2NoZWR1bGVyIHRvIHJ1bjoge3NlbGYuaW5zdGFsbF9kaXJ9L3N0YXJ0X3Z1bG5ndWFyZC5iYXQiKQogICAgICAgIAogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgTGludXggc3lzdGVtZCBzZXJ2aWNlCiAgICAgICAgICAgIHNlcnZpY2VfY29udGVudCA9IGYiIiJbVW5pdF0KRGVzY3JpcHRpb249VnVsbkd1YXJkIFZ1bG5lcmFiaWxpdHkgTWFuYWdlbWVudCBQbGF0Zm9ybQpBZnRlcj1uZXR3b3JrLnRhcmdldAoKW1NlcnZpY2VdClR5cGU9Zm9ya2luZwpVc2VyPXZ1bG5ndWFyZApXb3JraW5nRGlyZWN0b3J5PXtzZWxmLmluc3RhbGxfZGlyfQpFeGVjU3RhcnQ9e3NlbGYuaW5zdGFsbF9kaXJ9L3N0YXJ0X3Z1bG5ndWFyZC5zaApFeGVjU3RvcD17c2VsZi5pbnN0YWxsX2Rpcn0vc3RvcF92dWxuZ3VhcmQuc2gKUmVzdGFydD1hbHdheXMKUmVzdGFydFNlYz0xMAoKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0CiIiIgogICAgICAgICAgICAKICAgICAgICAgICAgc2VydmljZV9wYXRoID0gUGF0aCgnL2V0Yy9zeXN0ZW1kL3N5c3RlbS92dWxuZ3VhcmQuc2VydmljZScpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihzZXJ2aWNlX3BhdGgsICd3JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKHNlcnZpY2VfY29udGVudCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydzdWRvJywgJ3N5c3RlbWN0bCcsICdkYWVtb24tcmVsb2FkJ10sIGNoZWNrPVRydWUpCiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ3N1ZG8nLCAnc3lzdGVtY3RsJywgJ2VuYWJsZScsICd2dWxuZ3VhcmQnXSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcHJpbnQoIuKchSBTeXN0ZW0gc2VydmljZSBjb25maWd1cmVkIikKICAgICAgICAgICAgICAgIHByaW50KCIgICBTdGFydCB3aXRoOiBzdWRvIHN5c3RlbWN0bCBzdGFydCB2dWxuZ3VhcmQiKQogICAgICAgICAgICAgICAgcHJpbnQoIiAgIFN0b3Agd2l0aDogc3VkbyBzeXN0ZW1jdGwgc3RvcCB2dWxuZ3VhcmQiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KGYi4pqg77iPICBDb3VsZCBub3Qgc2V0dXAgc3lzdGVtIHNlcnZpY2U6IHtlfSIpCiAgICAKICAgIGRlZiBydW5faW5pdGlhbF9zZXR1cChzZWxmKToKICAgICAgICAiIiJSdW4gaW5pdGlhbCBwbGF0Zm9ybSBzZXR1cCIiIgogICAgICAgIHByaW50KCJcbvCflKcgUnVubmluZyBpbml0aWFsIHNldHVwLi4uIikKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgU3RhcnQgTW9uZ29EQgogICAgICAgICAgICBwcmludCgiU3RhcnRpbmcgTW9uZ29EQi4uLiIpCiAgICAgICAgICAgIGlmIHNlbGYucGxhdGZvcm0gPT0gJ3dpbmRvd3MnOgogICAgICAgICAgICAgICAgbW9uZ29kYl9wYXRoID0gc2VsZi5pbnN0YWxsX2RpciAvICdtb25nb2RiJyAvICdiaW4nIC8gJ21vbmdvZC5leGUnCiAgICAgICAgICAgICAgICBpZiBtb25nb2RiX3BhdGguZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5Qb3Blbihbc3RyKG1vbmdvZGJfcGF0aCksICctLWRicGF0aCcsIHN0cihzZWxmLmluc3RhbGxfZGlyIC8gJ2RhdGEnKV0pCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKFsnbW9uZ29kJywgJy0tZGJwYXRoJywgc3RyKHNlbGYuaW5zdGFsbF9kaXIgLyAnZGF0YScpXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkgICMgV2FpdCBmb3IgTW9uZ29EQiB0byBzdGFydAogICAgICAgICAgICAKICAgICAgICAgICAgIyBJbml0aWFsaXplIGRhdGFiYXNlCiAgICAgICAgICAgIHByaW50KCJJbml0aWFsaXppbmcgZGF0YWJhc2UuLi4iKQogICAgICAgICAgICAjIFRoaXMgd291bGQgcnVuIGRhdGFiYXNlIGluaXRpYWxpemF0aW9uIHNjcmlwdHMKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KCLinIUgSW5pdGlhbCBzZXR1cCBjb21wbGV0ZWQiKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4p2MIEluaXRpYWwgc2V0dXAgZmFpbGVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIGluc3RhbGwoc2VsZik6CiAgICAgICAgIiIiUnVuIGNvbXBsZXRlIGluc3RhbGxhdGlvbiIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuY2hlY2tfcHJlcmVxdWlzaXRlcygpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5pbnN0YWxsX3B5dGhvbigpOgogICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBQeXRob24gaW5zdGFsbGF0aW9uIGZhaWxlZCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmluc3RhbGxfbm9kZWpzKCk6CiAgICAgICAgICAgICAgICBwcmludCgi4p2MIE5vZGUuanMgaW5zdGFsbGF0aW9uIGZhaWxlZCIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG5vdCBzZWxmLmluc3RhbGxfbW9uZ29kYigpOgogICAgICAgICAgICAgICAgcHJpbnQoIuKdjCBNb25nb0RCIGluc3RhbGxhdGlvbiBmYWlsZWQiKQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmNyZWF0ZV9kaXJlY3Rvcnlfc3RydWN0dXJlKCkKICAgICAgICAgICAgc2VsZi5pbnN0YWxsX3Z1bG5ndWFyZF9wbGF0Zm9ybSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgc2VsZi5pbnN0YWxsX3B5dGhvbl9kZXBlbmRlbmNpZXMoKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHNlbGYuaW5zdGFsbF9ub2RlX2RlcGVuZGVuY2llcygpOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmNyZWF0ZV9zdGFydHVwX3NjcmlwdHMoKQogICAgICAgICAgICBzZWxmLmNyZWF0ZV9kZXNrdG9wX3Nob3J0Y3V0cygpCiAgICAgICAgICAgIHNlbGYuc2V0dXBfc3lzdGVtX3NlcnZpY2UoKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgbm90IHNlbGYucnVuX2luaXRpYWxfc2V0dXAoKToKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoIlxu8J+OiSBWdWxuR3VhcmQgaW5zdGFsbGF0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkhIikKICAgICAgICAgICAgcHJpbnQoIj0iKjUwKQogICAgICAgICAgICBwcmludChmIkluc3RhbGxhdGlvbiBEaXJlY3Rvcnk6IHtzZWxmLmluc3RhbGxfZGlyfSIpCiAgICAgICAgICAgIHByaW50KGYiV2ViIEludGVyZmFjZTogaHR0cDovL2xvY2FsaG9zdDozMDAwIikKICAgICAgICAgICAgcHJpbnQoZiJBUEkgRW5kcG9pbnQ6IGh0dHA6Ly9sb2NhbGhvc3Q6ODAwMS9hcGkiKQogICAgICAgICAgICBwcmludCgiXG5TdGFydHVwIENvbW1hbmRzOiIpCiAgICAgICAgICAgIGlmIHNlbGYucGxhdGZvcm0gPT0gJ3dpbmRvd3MnOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIFN0YXJ0OiB7c2VsZi5pbnN0YWxsX2Rpcn0vc3RhcnRfdnVsbmd1YXJkLmJhdCIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgU3RvcDoge3NlbGYuaW5zdGFsbF9kaXJ9L3N0b3BfdnVsbmd1YXJkLmJhdCIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIiAgU3RhcnQ6IHtzZWxmLmluc3RhbGxfZGlyfS9zdGFydF92dWxuZ3VhcmQuc2giKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIFN0b3A6IHtzZWxmLmluc3RhbGxfZGlyfS9zdG9wX3Z1bG5ndWFyZC5zaCIpCiAgICAgICAgICAgIHByaW50KCI9Iio1MCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICAgICAgcHJpbnQoIlxu4p2MIEluc3RhbGxhdGlvbiBjYW5jZWxsZWQgYnkgdXNlciIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJcbuKdjCBJbnN0YWxsYXRpb24gZmFpbGVkOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAjIENsZWFudXAgdGVtcCBkaXJlY3RvcnkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2h1dGlsLnJtdHJlZShzZWxmLnRlbXBfZGlyKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAKICAgICMgQ29uZmlndXJhdGlvbiBmaWxlIHRlbXBsYXRlcwogICAgZGVmIGdldF9iYWNrZW5kX2NvZGUoc2VsZik6CiAgICAgICAgcmV0dXJuICcnJyMgVnVsbkd1YXJkIEJhY2tlbmQgLSBTaW1wbGlmaWVkIFZlcnNpb24KZnJvbSBmYXN0YXBpIGltcG9ydCBGYXN0QVBJCmZyb20gZmFzdGFwaS5taWRkbGV3YXJlLmNvcnMgaW1wb3J0IENPUlNNaWRkbGV3YXJlCgphcHAgPSBGYXN0QVBJKHRpdGxlPSJWdWxuR3VhcmQgQVBJIikKCmFwcC5hZGRfbWlkZGxld2FyZSgKICAgIENPUlNNaWRkbGV3YXJlLAogICAgYWxsb3dfb3JpZ2lucz1bIioiXSwKICAgIGFsbG93X21ldGhvZHM9WyIqIl0sCiAgICBhbGxvd19oZWFkZXJzPVsiKiJdLAopCgpAYXBwLmdldCgiL2FwaS8iKQphc3luYyBkZWYgcm9vdCgpOgogICAgcmV0dXJuIHsibWVzc2FnZSI6ICJWdWxuR3VhcmQgQVBJIiwgInN0YXR1cyI6ICJydW5uaW5nIn0KCkBhcHAuZ2V0KCIvYXBpL2hlYWx0aCIpCmFzeW5jIGRlZiBoZWFsdGhfY2hlY2soKToKICAgIHJldHVybiB7InN0YXR1cyI6ICJoZWFsdGh5In0KCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICBpbXBvcnQgdXZpY29ybgogICAgdXZpY29ybi5ydW4oYXBwLCBob3N0PSIwLjAuMC4wIiwgcG9ydD04MDAxKQonJycKICAgIAogICAgZGVmIGdldF9yZXF1aXJlbWVudHMoc2VsZik6CiAgICAgICAgcmV0dXJuICcnJ2Zhc3RhcGk9PTAuMTEwLjEKdXZpY29ybj09MC4yNS4wCnB5bW9uZ289PTQuNS4wCm1vdG9yPT0zLjMuMQpweXRob24tbXVsdGlwYXJ0Pj0wLjAuOQpyZXF1ZXN0cz49Mi4zMS4wCnB5ZGFudGljPj0yLjYuNApweXRob24tZG90ZW52Pj0xLjAuMQonJycKICAgIAogICAgZGVmIGdldF9iYWNrZW5kX2VudihzZWxmKToKICAgICAgICByZXR1cm4gJycnTU9OR09fVVJMPW1vbmdvZGI6Ly9sb2NhbGhvc3Q6MjcwMTcKREJfTkFNRT12dWxuZ3VhcmRfZGIKQ09SU19PUklHSU5TPSoKJycnCiAgICAKICAgIGRlZiBnZXRfcGFja2FnZV9qc29uKHNlbGYpOgogICAgICAgIHJldHVybiAiIiJ7CiAgIm5hbWUiOiAidnVsbmd1YXJkLWZyb250ZW5kIiwKICAidmVyc2lvbiI6ICIyLjAuMCIsCiAgInByaXZhdGUiOiB0cnVlLAogICJkZXBlbmRlbmNpZXMiOiB7CiAgICAicmVhY3QiOiAiXjE5LjAuMCIsCiAgICAicmVhY3QtZG9tIjogIl4xOS4wLjAiLAogICAgInJlYWN0LXNjcmlwdHMiOiAiNS4wLjEiLAogICAgImF4aW9zIjogIl4xLjguNCIKICB9LAogICJzY3JpcHRzIjogewogICAgInN0YXJ0IjogInJlYWN0LXNjcmlwdHMgc3RhcnQiLAogICAgImJ1aWxkIjogInJlYWN0LXNjcmlwdHMgYnVpbGQiLAogICAgInRlc3QiOiAicmVhY3Qtc2NyaXB0cyB0ZXN0IgogIH0KfSIiIgogICAgCiAgICBkZWYgZ2V0X2Zyb250ZW5kX2VudihzZWxmKToKICAgICAgICByZXR1cm4gJ1JFQUNUX0FQUF9CQUNLRU5EX1VSTD1odHRwOi8vbG9jYWxob3N0OjgwMDFcbicKICAgIAogICAgZGVmIGdldF9yZWFjdF9hcHAoc2VsZik6CiAgICAgICAgcmV0dXJuICcnJ2ltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCAnLi9BcHAuY3NzJzsKCmZ1bmN0aW9uIEFwcCgpIHsKICByZXR1cm4gKAogICAgPGRpdiBjbGFzc05hbWU9IkFwcCI+CiAgICAgIDxoZWFkZXIgY2xhc3NOYW1lPSJBcHAtaGVhZGVyIj4KICAgICAgICA8aDE+8J+boe+4jyBWdWxuR3VhcmQ8L2gxPgogICAgICAgIDxwPlZ1bG5lcmFiaWxpdHkgTWFuYWdlbWVudCBQbGF0Zm9ybSB2Mi4wPC9wPgogICAgICAgIDxwPkluc3RhbGxhdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5ITwvcD4KICAgICAgPC9oZWFkZXI+CiAgICA8L2Rpdj4KICApOwp9CgpleHBvcnQgZGVmYXVsdCBBcHA7CicnJwogICAgCiAgICBkZWYgZ2V0X3dpbmRvd3Nfc3RhcnRfc2NyaXB0KHNlbGYpOgogICAgICAgIHJldHVybiBmJycnQGVjaG8gb2ZmCmVjaG8gU3RhcnRpbmcgVnVsbkd1YXJkIFBsYXRmb3JtLi4uCgpSRU0gU3RhcnQgTW9uZ29EQgpzdGFydCAiTW9uZ29EQiIgL21pbiAie3NlbGYuaW5zdGFsbF9kaXJ9XFxtb25nb2RiXFxiaW5cXG1vbmdvZC5leGUiIC0tZGJwYXRoICJ7c2VsZi5pbnN0YWxsX2Rpcn1cXGRhdGEiCgpSRU0gV2FpdCBmb3IgTW9uZ29EQgp0aW1lb3V0IC90IDEwCgpSRU0gU3RhcnQgQmFja2VuZApjZCAvZCAie3NlbGYuaW5zdGFsbF9kaXJ9XFxiYWNrZW5kIgpzdGFydCAiVnVsbkd1YXJkIEJhY2tlbmQiIHZlbnZcXFNjcmlwdHNcXHB5dGhvbi5leGUgc2VydmVyLnB5CgpSRU0gU3RhcnQgRnJvbnRlbmQKY2QgL2QgIntzZWxmLmluc3RhbGxfZGlyfVxcZnJvbnRlbmQiCnN0YXJ0ICJWdWxuR3VhcmQgRnJvbnRlbmQiIG5wbSBzdGFydAoKZWNobyBWdWxuR3VhcmQgUGxhdGZvcm0gc3RhcnRlZCEKZWNobyBXZWIgSW50ZXJmYWNlOiBodHRwOi8vbG9jYWxob3N0OjMwMDAKZWNobyBBUEkgRW5kcG9pbnQ6IGh0dHA6Ly9sb2NhbGhvc3Q6ODAwMS9hcGkKcGF1c2UKJycnCiAgICAKICAgIGRlZiBnZXRfd2luZG93c19zdG9wX3NjcmlwdChzZWxmKToKICAgICAgICByZXR1cm4gJycnQGVjaG8gb2ZmCmVjaG8gU3RvcHBpbmcgVnVsbkd1YXJkIFBsYXRmb3JtLi4uCgp0YXNra2lsbCAvZiAvaW0gcHl0aG9uLmV4ZQp0YXNra2lsbCAvZiAvaW0gbm9kZS5leGUKdGFza2tpbGwgL2YgL2ltIG1vbmdvZC5leGUKCmVjaG8gVnVsbkd1YXJkIFBsYXRmb3JtIHN0b3BwZWQhCnBhdXNlCicnJwogICAgCiAgICBkZWYgZ2V0X2xpbnV4X3N0YXJ0X3NjcmlwdChzZWxmKToKICAgICAgICByZXR1cm4gZicnJyMhL2Jpbi9iYXNoCmVjaG8gIlN0YXJ0aW5nIFZ1bG5HdWFyZCBQbGF0Zm9ybS4uLiIKCiMgU3RhcnQgTW9uZ29EQgptb25nb2QgLS1kYnBhdGggIntzZWxmLmluc3RhbGxfZGlyfS9kYXRhIiAtLWZvcmsgLS1sb2dwYXRoICJ7c2VsZi5pbnN0YWxsX2Rpcn0vbG9ncy9tb25nb2RiLmxvZyIKCiMgV2FpdCBmb3IgTW9uZ29EQgpzbGVlcCAxMAoKIyBTdGFydCBCYWNrZW5kCmNkICJ7c2VsZi5pbnN0YWxsX2Rpcn0vYmFja2VuZCIKc291cmNlIHZlbnYvYmluL2FjdGl2YXRlCnB5dGhvbiBzZXJ2ZXIucHkgJgplY2hvICQhID4gLi4vbG9ncy9iYWNrZW5kLnBpZAoKIyBTdGFydCBGcm9udGVuZApjZCAie3NlbGYuaW5zdGFsbF9kaXJ9L2Zyb250ZW5kIgpucG0gc3RhcnQgJgplY2hvICQhID4gLi4vbG9ncy9mcm9udGVuZC5waWQKCmVjaG8gIlZ1bG5HdWFyZCBQbGF0Zm9ybSBzdGFydGVkISIKZWNobyAiV2ViIEludGVyZmFjZTogaHR0cDovL2xvY2FsaG9zdDozMDAwIgplY2hvICJBUEkgRW5kcG9pbnQ6IGh0dHA6Ly9sb2NhbGhvc3Q6ODAwMS9hcGkiCicnJwogICAgCiAgICBkZWYgZ2V0X2xpbnV4X3N0b3Bfc2NyaXB0KHNlbGYpOgogICAgICAgIHJldHVybiBmJycnIyEvYmluL2Jhc2gKZWNobyAiU3RvcHBpbmcgVnVsbkd1YXJkIFBsYXRmb3JtLi4uIgoKIyBTdG9wIHByb2Nlc3NlcwppZiBbIC1mICJ7c2VsZi5pbnN0YWxsX2Rpcn0vbG9ncy9iYWNrZW5kLnBpZCIgXTsgdGhlbgogICAga2lsbCAkKGNhdCAie3NlbGYuaW5zdGFsbF9kaXJ9L2xvZ3MvYmFja2VuZC5waWQiKQogICAgcm0gIntzZWxmLmluc3RhbGxfZGlyfS9sb2dzL2JhY2tlbmQucGlkIgpmaQoKaWYgWyAtZiAie3NlbGYuaW5zdGFsbF9kaXJ9L2xvZ3MvZnJvbnRlbmQucGlkIiBdOyB0aGVuCiAgICBraWxsICQoY2F0ICJ7c2VsZi5pbnN0YWxsX2Rpcn0vbG9ncy9mcm9udGVuZC5waWQiKQogICAgcm0gIntzZWxmLmluc3RhbGxfZGlyfS9sb2dzL2Zyb250ZW5kLnBpZCIKZmkKCiMgU3RvcCBNb25nb0RCCnBraWxsIG1vbmdvZAoKZWNobyAiVnVsbkd1YXJkIFBsYXRmb3JtIHN0b3BwZWQhIgonJycKCmRlZiBtYWluKCk6CiAgICBpZiBsZW4oc3lzLmFyZ3YpID4gMSBhbmQgc3lzLmFyZ3ZbMV0gPT0gJy0tdW5pbnN0YWxsJzoKICAgICAgICBwcmludCgi8J+Xke+4jyAgVnVsbkd1YXJkIFVuaW5zdGFsbGVyIikKICAgICAgICBwcmludCgiVGhpcyB3b3VsZCByZW1vdmUgVnVsbkd1YXJkIGluc3RhbGxhdGlvbiIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGluc3RhbGxlciA9IFZ1bG5HdWFyZEluc3RhbGxlcigpCiAgICAKICAgIHByaW50KCJcblRoaXMgaW5zdGFsbGVyIHdpbGw6IikKICAgIHByaW50KCLigKIgSW5zdGFsbCBQeXRob24sIE5vZGUuanMsIGFuZCBNb25nb0RCIikKICAgIHByaW50KCLigKIgRG93bmxvYWQgYW5kIHNldHVwIFZ1bG5HdWFyZCBwbGF0Zm9ybSIpCiAgICBwcmludCgi4oCiIENyZWF0ZSBzdGFydHVwIHNjcmlwdHMgYW5kIHNob3J0Y3V0cyIpCiAgICBwcmludCgi4oCiIENvbmZpZ3VyZSBzeXN0ZW0gc2VydmljZXMiKQogICAgCiAgICB0cnk6CiAgICAgICAgcmVzcG9uc2UgPSBpbnB1dCgiXG5Qcm9jZWVkIHdpdGggaW5zdGFsbGF0aW9uPyAoeS9OKTogIikKICAgICAgICBpZiByZXNwb25zZS5sb3dlcigpIG5vdCBpbiBbJ3knLCAneWVzJ106CiAgICAgICAgICAgIHByaW50KCJJbnN0YWxsYXRpb24gY2FuY2VsbGVkLiIpCiAgICAgICAgICAgIHJldHVybgogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KCJcbkluc3RhbGxhdGlvbiBjYW5jZWxsZWQuIikKICAgICAgICByZXR1cm4KICAgIAogICAgc3VjY2VzcyA9IGluc3RhbGxlci5pbnN0YWxsKCkKICAgIAogICAgaWYgc3VjY2VzczoKICAgICAgICBwcmludCgiXG7wn46JIEluc3RhbGxhdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5ISIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IGlucHV0KCJcblN0YXJ0IFZ1bG5HdWFyZCBub3c/ICh5L04pOiAiKQogICAgICAgICAgICBpZiByZXNwb25zZS5sb3dlcigpIGluIFsneScsICd5ZXMnXToKICAgICAgICAgICAgICAgIGlmIGluc3RhbGxlci5wbGF0Zm9ybSA9PSAnd2luZG93cyc6CiAgICAgICAgICAgICAgICAgICAgc3VicHJvY2Vzcy5Qb3Blbihbc3RyKGluc3RhbGxlci5pbnN0YWxsX2RpciAvICdzdGFydF92dWxuZ3VhcmQuYmF0JyldKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzdWJwcm9jZXNzLlBvcGVuKFtzdHIoaW5zdGFsbGVyLmluc3RhbGxfZGlyIC8gJ3N0YXJ0X3Z1bG5ndWFyZC5zaCcpXSkKICAgICAgICAgICAgICAgIHByaW50KCJWdWxuR3VhcmQgaXMgc3RhcnRpbmcuLi4iKQogICAgICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICAgICAgcGFzcwogICAgZWxzZToKICAgICAgICBwcmludCgiXG7inYwgSW5zdGFsbGF0aW9uIGZhaWxlZCEiKQogICAgICAgIHN5cy5leGl0KDEpCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigp > "%TEMP%\vulnguard_code.b64"
python -c "import base64; exec(base64.b64decode(open('%TEMP%\\vulnguard_code.b64').read().strip()).decode())" %*

REM Cleanup
if exist "%TEMP%\vulnguard_code.b64" del "%TEMP%\vulnguard_code.b64"
if exist "%TEMP_SCRIPT%" del "%TEMP_SCRIPT%"
